// ðŸ“ api/routes/submissoesAdminRoutes.js
const express = require("express");
const router = express.Router();

const requireAuth = require("../auth/authMiddleware");
const authorizeRoles = require("../auth/authorizeRoles");
const ctrl = require("../controllers/submissoesAdminController");
const trabalhosCtrl = require("../controllers/trabalhosController");

const requireAdmin = [requireAuth, authorizeRoles("administrador")];

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Listagem administrativa de submissÃµes
   GET /api/admin/submissoes
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
router.get(
  "/admin/submissoes",
  requireAdmin,
  ctrl.listarSubmissoesAdmin
);

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Avaliadores (ADMIN)
   GET/POST /api/admin/submissoes/:id/avaliadores
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
router.get(
  "/admin/submissoes/:id(\\d+)/avaliadores",
  requireAdmin,
  ctrl.listarAvaliadoresDaSubmissao
);

router.post(
  "/admin/submissoes/:id(\\d+)/avaliadores",
  requireAdmin,
  ctrl.atribuirAvaliadores
);

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   AvaliaÃ§Ãµes / Notas (ADMIN)
   GET /api/admin/submissoes/:id/avaliacoes
   POST /api/admin/submissoes/:id/nota-visivel
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
router.get(
  "/admin/submissoes/:id(\\d+)/avaliacoes",
  requireAdmin,
  ctrl.listarAvaliacoesDaSubmissao
);

router.post(
  "/admin/submissoes/:id(\\d+)/nota-visivel",
  requireAdmin,
  ctrl.definirNotaVisivel
);

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   AtualizaÃ§Ã£o de nota mÃ©dia (materializada)
   POST /api/admin/submissoes/:id/atualizar-nota
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
router.post(
  "/admin/submissoes/:id(\\d+)/atualizar-nota",
  requireAdmin,
  async (req, res) => {
    try {
      const { atualizarNotaMediaMaterializada } = require("../controllers/submissoesAdminController");
      await atualizarNotaMediaMaterializada(Number(req.params.id));
      res.json({ ok: true });
    } catch (err) {
      console.error("[/admin/submissoes/:id/atualizar-nota]", err);
      res.status(500).json({ error: "Falha ao recalcular nota mÃ©dia." });
    }
  }
);

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Download do pÃ´ster (PÃšBLICO)
   MantÃ©m compatibilidade com /banner
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
router.get("/submissoes/:id(\\d+)/poster", ctrl.baixarBanner);
router.get("/submissoes/:id(\\d+)/banner", ctrl.baixarBanner);

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Alias de detalhe da submissÃ£o
   (ADMIN/autor/avaliador) â€” somente IDs numÃ©ricos,
   para NÃƒO capturar caminhos textuais como /minhas.
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
router.get(
  "/submissoes/:id(\\d+)",
  requireAuth,
  trabalhosCtrl.obterSubmissao
);

module.exports = router;
